
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Areas/PC/Views/Shared/_PatrolLayout.cshtml";
}

<div class="Dashboard">
    <div class="Calendar">
        <div id="calendar"></div>
    </div>
    <div class="Schedule">
        <div class="ScheduleToday mb-4">
            <p>Schedule this Month</p>
            <div class="Schedule_listContainer" id="Schedule_contain">
                <div class="Schedule_listContent">

                </div>
            </div>
        </div>

        <div class="ScheduleNext">
            <p>Next Schedule</p>
            <div class="ScheduleNext_listContainer" id="ScheduleNext_contain">
                <div class="ScheduleNext_listContent">

                </div>
            </div>
        </div>
    </div>
</div>





<script src="~/Scripts/fullcalendar@6.1.17/index.global.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.min.js"></script>
<script src="~/Scripts/Utilities.js"></script>
<script type="text/javascript">
    let Sched = [];


    const CalendarData = async () => {
        var SetData = $("#Schedule_contain");
        let res = await FetchAuthenticate('@Url.Action("GetScheduleDateList", "Patrol")', {});
        if (res && res.Success) {
            Sched = res.Data;
            $.each(Sched, function (index, res) {

                const card = `
                     <div class="Schedule_listContent">
                          <h5>${res.FullName}</h5>
                          <p>${res.ProcessName}</p>
                     </div>`;
                SetData.append(card);
            });
        } else {
            SetData.html("<p>No Patrol Schedule today.</p>");
        }
    }

    const NextCalendarData = async () => {
        var SetData = $("#Schedule_contain");
        let res = await FetchAuthenticate('@Url.Action("GetScheduleDateList", "Patrol")', {});
        if (res && res.Success) {
            Sched = res.Data;
            $.each(Sched, function (index, res) {

                const card = `
                     <div class="Schedule_listContent">
                          <h5 class='m-0'>${res.FullName}</h5>
                          <p>${res.ProcessName}</p>
                     </div>`;
                SetData.append(card);
            });
        } else {
            SetData.html("<p>No Patrol Schedule today.</p>");
        }
    }





    // Initialize Calendar (example with FullCalendar)
    document.addEventListener('DOMContentLoaded', function () {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const formattedDate = `${year}-${month}-${day}`;

        const calendarEl = document.getElementById('calendar');
        //headerToolbar: {
        //    left: 'prev,next today',
        //        center: 'title',
        //            right: 'dayGridMonth,listWeek'
        //},
        window.calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            height: 'auto',
            headerToolbar: {
                left: '',
                center: '',
                right: ''
            },
            events: [], // Start empty

            dayCellDidMount: function (info) {
                // Format info.date to local date string
                const cellDate = info.date.getFullYear() + '-' +
                    String(info.date.getMonth() + 1).padStart(2, '0') + '-' +
                    String(info.date.getDate()).padStart(2, '0');

                if (cellDate === formattedDate) {
                    info.el.style.backgroundColor = '#3664F4';
                    info.el.style.color = 'white';
                }
            },

            dateClick: function (info) {

            },

            eventClick: function (info) {

            }
        });

        calendar.render();
    });


    CalendarData();
</script>