async function refreshAccessToken(){let t=localStorage.getItem("Logout"),n=localStorage.getItem("refreshToken");if(!n)return!1;try{let i=await fetch("/User/RefreshToken",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:n})}),r=await i.json();if(i.ok&&r.accessToken)return localStorage.setItem("accessToken",r.accessToken),!0;console.warn("Refresh token failed. Logging out...");localStorage.clear();window.location.href=t}catch(i){return console.error("Error refreshing token:",i),!1}}window.FetchAuthenticate=async(n,t)=>{var i=localStorage.getItem("accessToken");let u=new URLSearchParams(t).toString(),f=`${n}?${u}`,r=async n=>await fetch(f,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}});try{let n=await r(i),t=localStorage.getItem("Logout");if(401===n.status){let u=await refreshAccessToken();if(u){if(n=await r(i=localStorage.getItem("accessToken")),401===n.status){localStorage.clear();window.location.href=t;return}if(401===n.status)return t&&(localStorage.clear(),window.location.href=t),null}else{localStorage.clear();window.location.href=t;return}}return await n.json()}catch(e){console.error("Error fetching data:",e)}};window.fetchData=async(n,t={})=>{console.clear();try{let i=new URLSearchParams(t).toString(),r=i?`${n}?${i}`:n,u=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});return await u.json()}catch(i){return console.error("Fetch Error:",i),null}};window.postData=async(n,t)=>{console.clear();try{let r=await fetch(n,{method:"POST",body:t}),i=await r.json();return r.ok&&!1!==i.Success||console.error("Server error:",i.Message||"Unknown error"),i}catch(i){return console.error("Error posting data:",i),null}};window.postrawData=async(n,t)=>{try{let i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r;try{return await i.json()}catch(u){console.error("Error parsing JSON:",u);let n=await i.text();return console.error("Raw response:",n),{Success:!1,Message:"Invalid JSON response",Raw:n}}if(!i.ok||!1===r.Success)return console.error("Server error:",r.Message||"Unknown error"),r}catch(i){return console.error("Error posting data:",i),null}};window.PullUserInformation=async()=>{let i=localStorage.getItem("accessToken"),t=await fetch("/User/GetUserInformation",{method:"POST",headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}});if(401===t.status){console.warn("Unauthorized");return}let n=await t.json();if(n.success)return n;console.warn(n.message||"Unknown error")};window.IsLoginUser=(n={})=>{let{storageKey:o,expectedValue:f,redirectUrl:t,redirectIfLoggedInUrl:u,expirationKey:i,maxHours:r}={storageKey:"isLoggedInPatrol",expectedValue:"true",redirectUrl:"/PC/Patrol/index",redirectIfLoggedInUrl:null,expirationKey:null,maxHours:null,...n},e=localStorage.getItem(o);if(e===f&&u)if(i&&r){let n=localStorage.getItem(i);if(n){let t=new Date(n),i=new Date,f=Math.abs(i-t)/36e5;if(f<=r){window.location.href=u;return}}}else{window.location.href=u;return}if(e!==f){let n=window.location.pathname,i=n!==t;if(i)if("function"==typeof ActionRestrict){let n=ActionRestrict();!1!==n&&(window.location.href=t)}else window.location.href=t;return}if(i&&r){let n=localStorage.getItem(i),u=window.location.pathname,f=new URL(t,window.location.origin).pathname;if(n){let i=new Date(n),e=new Date,o=Math.abs(e-i)/36e5;o>r&&(localStorage.clear(),u!==f&&(window.location.href=t))}else localStorage.clear(),u!==f&&(window.location.href=t)}};window.logout=async()=>{let n=localStorage.getItem("Logout");try{localStorage.clear();window.location.href=n}catch(t){console.error("Logout failed:",t)}};window.restrictChars=n=>{var t=n.which||n.keycode;return!!(t>=48)&&!!(t<=57)||46==t};