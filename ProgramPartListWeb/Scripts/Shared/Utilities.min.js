window.FetchAuthenticate=function(n,t){function u(n){return fetch(f,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}})}var i=localStorage.getItem("accessToken"),r=Object.keys(t||{}).map(function(n){return encodeURIComponent(n)+"="+encodeURIComponent(t[n])}).join("&"),f=n+(r?"?"+r:"");return u(i).then(function(n){var t=localStorage.getItem("Logout")||window.AppConfig.loginUrl;return n.status===401?refreshAccessToken().then(function(n){return n?(i=localStorage.getItem("accessToken"),u(i).then(function(n){return n.status===401?(localStorage.clear(),window.location.href=t,null):n.json()})):(localStorage.clear(),window.location.href=t,null)}):n.json()}).catch(function(n){console.error("Error fetching data:",n)})};window.fetchData=function(n,t){t===void 0&&(t={});var i=Object.keys(t||{}).map(function(n){return encodeURIComponent(n)+"="+encodeURIComponent(t[n])}).join("&"),r=i?n+"?"+i:n;return fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).catch(function(n){return console.error("Fetch Error:",n),null})};window.postData=function(n,t){return fetch(n,{method:"POST",body:t}).then(function(n){return n.json().then(function(t){return n.ok&&t.Success!==!1||console.error("Server error:",t.Message||"Unknown error"),t})}).catch(function(n){return console.error("Error posting data:",n),null})};window.postrawData=function(n,t){return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(n){return n.json().then(function(t){return n.ok&&t.Success!==!1||console.error("Server error:",t.Message||"Unknown error"),t}).catch(function(t){return console.error("Error parsing JSON:",t),n.text().then(function(n){return console.error("Raw response:",n),{Success:!1,Message:"Invalid JSON response",Raw:n}})})}).catch(function(n){return console.error("Error posting data:",n),null})};window.PullUserInformation=function(){var n=localStorage.getItem("accessToken");return fetch("/User/GetUserInformation",{method:"POST",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"}}).then(function(n){if(n.status===401){console.warn("Unauthorized");return}return n.json().then(function(n){if(n.success)return console.log("User ID:",n.userId),console.log("Name:",n.name),console.log("Role:",n.role),n;console.warn(n.message||"Unknown error")})})};window.logout=function(){var n=localStorage.getItem("Logout");try{localStorage.clear();window.location.href=n}catch(t){console.error("Logout failed:",t)}};window.restrictChars=function(n){var t=n.which||n.keycode;return t>=48&&t<=57||t===46};window.ActionButtons=function(){var n=localStorage.getItem("UserRole");if(n==="Leader"||n==="Users")return!1};document.addEventListener("DOMContentLoaded",function(){const n=document.querySelectorAll("img.lazy");if("IntersectionObserver"in window){let t=new IntersectionObserver((n,t)=>{n.forEach(n=>{if(n.isIntersecting){const i=n.target;i.src=i.dataset.src;i.onload=()=>{i.classList.add("loaded")};i.removeAttribute("data-src");t.unobserve(i)}})});n.forEach(n=>t.observe(n))}else n.forEach(n=>{n.src=n.dataset.src,n.onload=()=>{n.classList.add("loaded")},n.removeAttribute("data-src")})});window.formatJsonDate=function(n){if(!n)return"";const t=parseInt(n.replace("/Date(","").replace(")/",""));if(isNaN(t))return"";const i=new Date(t);return i.toLocaleDateString()};window.GetMethod=function(n,t={},i={}){function o(n,t){if(!t||Object.keys(t).length===0)return n;const i=Object.entries(t).map(([n,t])=>`${encodeURIComponent(n)}=${encodeURIComponent(t)}`).join("&");return`${n}${n.includes("?")?"&":"?"}${i}`}function s(){const n=localStorage.getItem(r.tokenExpiryKey);if(!n)return!0;const t=Date.now(),i=parseInt(n,10);return t>=i-r.tokenRefreshThreshold}function u(r){const u={"Content-Type":"application/json",...i.headers};return r&&(u.Authorization=`Bearer ${r}`),fetch(o(n,t),{method:"GET",headers:u,credentials:"same-origin",...i,method:"GET"})}async function f(n,t,i=0){const o=()=>{localStorage.clear(),window.location.href=r.loginUrl};if(n.status===401&&t&&i===0)try{const n=await e();if(n){const n=localStorage.getItem(r.accessTokenKey),t=await u(n,1);return await f(t,n,1)}return o(),null}catch(s){return console.error("Token refresh error:",s),o(),null}if(n.status===401)return o(),null;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);try{return await n.json()}catch(s){return console.error("Error parsing JSON:",s),null}}async function e(){const n=localStorage.getItem(r.refreshTokenKey);if(!n)return console.warn("No refresh token available"),!1;try{const i=await fetch("/User/RefreshToken",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({refreshToken:n})});if(!i.ok)throw new Error(`Refresh token request failed: ${i.status}`);const t=await i.json();if(t.accessToken){if(localStorage.setItem(r.accessTokenKey,t.accessToken),t.expiresIn){const n=Date.now()+t.expiresIn*1e3;localStorage.setItem(r.tokenExpiryKey,n.toString())}return!0}return console.warn("Refresh token response missing accessToken"),!1}catch(t){return console.error("Error refreshing token:",t),!1}}const r={loginUrl:localStorage.getItem("Logout")||window.AppConfig?.loginUrl||"/login",accessTokenKey:"accessToken",refreshTokenKey:"refreshToken",tokenExpiryKey:"tokenExpiry",tokenRefreshThreshold:3e5,...i};return(async()=>{try{let n=localStorage.getItem(r.accessTokenKey);if(n&&s()){const t=await e();t?n=localStorage.getItem(r.accessTokenKey):n}const t=await u(n);return await f(t,n)}catch(n){console.error("Error in FetchAuthenticate:",n);const t=localStorage.getItem(r.accessTokenKey);if(!t&&n instanceof TypeError)return null;throw n;}})()};window.GetMethod.isAuthenticated=function(){const t=localStorage.getItem("accessToken"),n=localStorage.getItem("tokenExpiry");if(!t)return!1;if(n){const t=Date.now(),i=parseInt(n,10);return t<i}return!0};window.GetMethod.refreshToken=async function(){return await refreshAccessToken()};window.GetMethod.clearTokens=function(){localStorage.removeItem("accessToken");localStorage.removeItem("refreshToken");localStorage.removeItem("tokenExpiry")};window.postMethod=async function(n,t,i={}){if(!n)return console.error("postMethod: URL is required"),{Success:!1,Message:"URL missing"};const{headers:h={},contentType:e="application/json",throwOnError:f=!1,includeCredentials:c=!1,timeout:o=3e4,responseType:l="json"}=i,s=new AbortController,a=setTimeout(()=>s.abort(),o),r={method:"POST",headers:{...h},credentials:c?"include":"same-origin",signal:s.signal};t instanceof FormData?r.body=t:typeof t=="object"&&t!==null?(r.body=JSON.stringify(t),r.headers["Content-Type"]||(r.headers["Content-Type"]=e)):typeof t=="string"&&(r.body=t,r.headers["Content-Type"]||(r.headers["Content-Type"]=e));try{const u=await fetch(n,r);clearTimeout(a);let t="";if(u.status!==204&&(t=await u.text()),!u.ok){const n=new Error(`HTTP ${u.status}`);if(n.status=u.status,n.raw=t,f)throw n;}let i=t;if(l==="json")try{i=t?JSON.parse(t):null}catch{console.warn("Invalid JSON returned:",t);i={Success:!1,rawText:t}}if(i&&i.Success===!1&&f)throw new Error(i.Message||"Server error");return i}catch(u){if(u.name==="AbortError"&&(u.message=`Request timed out after ${o}ms`),f)throw u;return{Success:!1,Error:!0,Message:u.message,Status:u.status||0}}};