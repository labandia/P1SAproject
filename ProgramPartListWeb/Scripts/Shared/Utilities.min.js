(function(){function i(n,t){return!t||Object.keys(t).length===0?n:n+(n.includes("?")?"&":"?")+new URLSearchParams(t)}function r(n){const t=localStorage.getItem(n.tokenExpiryKey);return!t||Date.now()>=+t-n.tokenRefreshThreshold}async function t(n){const t=localStorage.getItem(n.refreshTokenKey);if(!t)return!1;try{const r=await fetch("/User/RefreshToken",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!r.ok)return!1;const i=await r.json();return i.accessToken?(localStorage.setItem(n.accessTokenKey,i.accessToken),i.expiresIn&&localStorage.setItem(n.tokenExpiryKey,(Date.now()+i.expiresIn*1e3).toString()),!0):!1}catch{return!1}}async function u(n,t,i){const r=new AbortController,u=setTimeout(()=>r.abort(),i);try{return await fetch(n,{...t,signal:r.signal})}finally{clearTimeout(u)}}const n={loginUrl:localStorage.getItem("Logout")||window.AppConfig?.loginUrl||"/login",accessTokenKey:"accessToken",refreshTokenKey:"refreshToken",tokenExpiryKey:"tokenExpiry",tokenRefreshThreshold:3e5,timeout:3e4,errorMessages:{network:"Network error. Please check your connection.",timeout:"Request timeout. Please try again.",unauthorized:"Session expired. Please log in again.",forbidden:"You do not have permission to access this resource.",server:"Server error. Please try again later.",notFound:"Requested resource not found.",badRequest:"Invalid request.",refreshFailed:"Unable to refresh session.",jsonParse:"Failed to parse server response.",general:"An error occurred."}};window.GetMethod=async function(f,e={},o={}){const s={...n,...o};let h=localStorage.getItem(s.accessTokenKey);h&&r(s)&&(await t(s),h=localStorage.getItem(s.accessTokenKey));const c={...(o.headers||{})};h&&(c.Authorization=`Bearer ${h}`);try{const n=await u(i(f,e),{method:"GET",headers:c,credentials:"same-origin"},s.timeout);if(n.status===401){const n=await t(s);if(!n){localStorage.clear();location.href=s.loginUrl;return}return GetMethod(f,e,o)}if(!n.ok)return{success:!1,status:n.status,message:s.errorMessages.general};return await n.json()}catch(l){return l.name==="AbortError"?{success:!1,message:s.errorMessages.timeout}:{success:!1,message:s.errorMessages.network}}};window.GetMethod.isAuthenticated=function(){const i=localStorage.getItem(n.accessTokenKey),t=localStorage.getItem(n.tokenExpiryKey);return!!i&&(!t||Date.now()<+t)};window.GetMethod.refreshToken=()=>t(n);window.GetMethod.clearTokens=function(){localStorage.removeItem("accessToken");localStorage.removeItem("refreshToken");localStorage.removeItem("tokenExpiry")}})();window.PullUserInformation=function(){var n=localStorage.getItem("accessToken");return fetch("/User/GetUserInformation",{method:"POST",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"}}).then(function(n){if(n.status===401){console.warn("Unauthorized");return}return n.json().then(function(n){if(n.success)return console.log("User ID:",n.userId),console.log("Name:",n.name),console.log("Role:",n.role),n;console.warn(n.message||"Unknown error")})})};window.logout=function(){var n=localStorage.getItem("Logout");try{localStorage.clear();window.location.href=n}catch(t){console.error("Logout failed:",t)}};window.restrictChars=function(n){var t=n.which||n.keycode;return t>=48&&t<=57||t===46};window.ActionButtons=function(){var n=localStorage.getItem("UserRole");if(n==="Leader"||n==="Users")return!1};document.addEventListener("DOMContentLoaded",function(){const n=document.querySelectorAll("img.lazy");if("IntersectionObserver"in window){let t=new IntersectionObserver((n,t)=>{n.forEach(n=>{if(n.isIntersecting){const i=n.target;i.src=i.dataset.src;i.onload=()=>{i.classList.add("loaded")};i.removeAttribute("data-src");t.unobserve(i)}})});n.forEach(n=>t.observe(n))}else n.forEach(n=>{n.src=n.dataset.src,n.onload=()=>{n.classList.add("loaded")},n.removeAttribute("data-src")})});window.formatJsonDate=function(n){if(!n)return"";const t=parseInt(n.replace("/Date(","").replace(")/",""));if(isNaN(t))return"";const i=new Date(t);return i.toLocaleDateString()};window.postMethod=async function(n,t,i={}){if(!n)return console.error("postMethod: URL is required"),{Success:!1,Message:"URL missing"};const{headers:h={},contentType:e="application/json",throwOnError:f=!1,includeCredentials:c=!1,timeout:o=3e4,responseType:l="json"}=i,s=new AbortController,a=setTimeout(()=>s.abort(),o),r={method:"POST",headers:{...h},credentials:c?"include":"same-origin",signal:s.signal};t instanceof FormData?r.body=t:typeof t=="object"&&t!==null?(r.body=JSON.stringify(t),r.headers["Content-Type"]||(r.headers["Content-Type"]=e)):typeof t=="string"&&(r.body=t,r.headers["Content-Type"]||(r.headers["Content-Type"]=e));try{const u=await fetch(n,r);clearTimeout(a);let t="";if(u.status!==204&&(t=await u.text()),!u.ok){const n=new Error(`HTTP ${u.status}`);if(n.status=u.status,n.raw=t,f)throw n;}let i=t;if(l==="json")try{i=t?JSON.parse(t):null}catch{console.warn("Invalid JSON returned:",t);i={Success:!1,rawText:t}}if(i&&i.Success===!1&&f)throw new Error(i.Message||"Server error");return i}catch(u){if(u.name==="AbortError"&&(u.message=`Request timed out after ${o}ms`),f)throw u;return{Success:!1,Error:!0,Message:u.message,Status:u.status||0}}};